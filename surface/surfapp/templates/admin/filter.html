{% load i18n unfold surface_templatetags %}

<div class="flex flex-col group mb-5 last:mb-4">
    <div class="flex flex-col gap-2">
        <label class="block font-semibold text-font-important-light dark:text-font-important-dark">
            {% blocktranslate with filter_title=title %} By {{ filter_title }} {% endblocktranslate %}
        </label>

            {% if spec|class_name == "BooleanFieldListFilter" or spec.horizontal %}
                {% for choice in choices %}
                    {% if choice.selected and spec.lookup_val.0 %}
                        <input type="hidden" name="{{ spec.lookup_kwarg }}" value="{{ spec.lookup_val.0 }}" />
                    {% endif %}
                {% endfor %}
                <ul class="dark:bg-base-900 border border-base-200 flex min-w-20 rounded-default shadow-xs text-font-default-light dark:border-base-700 dark:text-font-default-dark w-full">
                    {% for choice in choices %}
                        <li class="basis-1/3 border-r border-base-200 grow truncate last:border-r-0 dark:border-base-700 {% if choice.selected %}font-semibold text-primary-600 dark:text-primary-500 {% else %}hover:text-base-700 dark:hover:text-base-200{% endif %}">
                            <a href="{{ choice.query_string|iriencode }}" title="{{ choice.display }}" class="block py-2 text-center hover:text-primary-600 dark:hover:text-primary-500">
                                {{ choice.display }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            {% elif spec|class_name == "DateFieldListFilter" %}
                {% for choice in choices %}
                    {% if choice.selected and spec.lookup_val.0 %}
                        <input type="hidden" name="{{ spec.lookup_kwarg }}" value="{{ spec.lookup_val.0 }}" />
                    {% endif %}
            {% endfor %}
                <ul class="border border-base-200 flex flex-col rounded-default shadow-xs dark:border-base-700">
                    {% for choice in choices %}
                        <li class="border-b border-base-200 last:border-b-0 dark:border-base-700 {% if choice.selected %}font-semibold text-primary-600 dark:text-primary-500 {% else %}hover:text-base-700 dark:hover:text-base-200{% endif %}">
                            <a href="{{ choice.query_string|iriencode }}" title="{{ choice.display }}" class="block px-3 py-2 hover:text-primary-600 dark:hover:text-primary-500">
                                {{ choice.display }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <div class="grow relative max-w-2xl">
                    <select data-theme="admin-autocomplete" name="{{spec.lookup_kwarg}}" id="{{spec.lookup_kwarg}}" class="border border-base-200 bg-white font-medium min-w-20 placeholder-base-400 rounded-default shadow-xs text-font-default-light text-sm focus:outline-2 focus:-outline-offset-2 focus:outline-primary-600 group-[.errors]:border-red-600 focus:group-[.errors]:outline-red-600 dark:bg-base-900 dark:border-base-700 dark:text-font-default-dark dark:group-[.errors]:border-red-500 dark:focus:group-[.errors]:outline-red-500 dark:scheme-dark group-[.primary]:border-transparent px-3 py-2 w-full pr-8! max-w-2xl appearance-none truncate unfold-admin-autocomplete admin-autocomplete">
                        {% for choice in choices %}
                            <option
                                {% if choice.selected %}class="selected" selected{% endif %}
                                {% if choice.display == 'All' or choice.display == 'Any date' %}
                                    value=""
                                {% elif choice.display == "-" %}
                                    value="is_null"
                                    {% if spec.lookup_val.0 == 'is_null' %}selected{% endif %}
                                {% else %}
                                    value="{{ choice.query_string|get_query_param:spec.lookup_kwarg|default_if_none:'is_null' }}"
                                {% endif %}
                                title="{{ choice.display }}">
                                {{ choice.display }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            {% endif %}
    </div>
</div>

<script>
  // Remove all but the last occurrence of each form field on submit
(function() {
        'use strict';
        document.addEventListener('submit', function(event) {
            const form = event.target;
            if (form.id !== 'filter-form') return;
            const elements = Array.from(form.elements).filter(el => el.name);
            const nameMap = {};

            // Map each name to its last occurrence
            elements.forEach((el, idx) => {
                    nameMap[el.name] = idx;
            });

            // Disable all but the last occurrence for each name
            elements.forEach((el, idx) => {
                    if (nameMap[el.name] !== idx) {
                            el.name = '';
                            el.disabled = true;
                    }
            });
        });
})();
</script>

